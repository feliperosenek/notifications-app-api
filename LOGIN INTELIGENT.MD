## üîå **API (Backend)**

### **Rotas e Endpoints**

### **Sistema de Emails (Sendgrid)**
- **Configura√ß√£o**: 
  - Credenciais Sendgrid configuradas com token
  - Use @sendgrid/mail
  - Crie um novo modulo email com as rotas necess√°rias.
  - O email usado para o envio deve ser pass@easynotificationspost.dev
  - A chave key do sendgrid deve ser configurada na vari√°vel de ambiente SENDGRID_API_KEY
- **Funcionalidades**:
  - Envio de emails de defini√ß√£o de senha
  - Envio de emails de redefini√ß√£o de senha

#### 1. **Solicitar Defini√ß√£o de Senha**
```
POST /auth/request-local-password
```
- **Fun√ß√£o**: Enviar email com link para defini√ß√£o
- **Processo**:
  - Gerar token √∫nico e tempor√°rio
  - Enviar email com link contendo token
- **Seguran√ßa**: Rate limiting por email

#### 1.1. **Solicitar Redefini√ß√£o de Senha**
```
POST /auth/request-password-reset
```
- **Fun√ß√£o**: Enviar email com link para redefini√ß√£o de senha
- **Processo**:
  - Gerar token √∫nico e tempor√°rio
  - Salvar token no banco com expira√ß√£o
  - Enviar email com link para redefini√ß√£o
- **Seguran√ßa**: Rate limiting por email

### **Funcionalidades de Seguran√ßa**

#### 1. **Gera√ß√£o de Tokens**
- **Formato**: JWT ou token √∫nico
- **Expira√ß√£o**: 15 minutos
- Ao acessar o link, deve verificar se o token tem mais de 15minutos do que foi criado. Insira a data no token se for possivel, se n√£o for possivel insira a data como parametro criptografado.

#### 2. **Sistema de Emails**
- **Template**: Email profissional com link seguro
- **Link**: `https://seudominio.com/set-password?token=ABC123&email=user@email.com`
- **Valida√ß√£o**: Token √∫nico por solicita√ß√£o
- **Provedor**: Sendgrid
- **Configura√ß√£o**: 
  - Templates HTML para defini√ß√£o e redefini√ß√£o de senha
  - Configura√ß√£o de dom√≠nio verificado
  - Rate limits e configura√ß√µes de entrega

#### 3. **Rate Limiting**
- **Por email**: M√°ximo 3 solicita√ß√µes por hora
- **Por IP**: M√°ximo 10 solicita√ß√µes por hora
- **Bloqueio**: Tempor√°rio em caso de abuso

#### 4. **Auditoria e Logs**
- **Registro**: Todas as tentativas de defini√ß√£o de senha
- **Rastreamento**: IP, timestamp, email, resultado
- **Alertas**: Tentativas suspeitas ou falhas

---

## üîÑ **Fluxo de Funcionamento**

### **Cen√°rio 1: Usu√°rio sem Senha Local**
1. Usu√°rio tenta login local
2. Sistema verifica se tem senha no banco
3. Se n√£o tiver, abre modal para solicitar email
4. Usu√°rio insere email da conta
5. API envia email com link para defini√ß√£o
6. Usu√°rio clica no link e define senha ao voltar no app e faz login

### **Cen√°rio 1.1: Usu√°rio Esqueceu a Senha**
1. Usu√°rio clica em "Esqueceu sua senha?"
2. Modal abre para inserir email da conta
3. Usu√°rio insere email
4. API envia email com link para redefini√ß√£o
5. Usu√°rio clica no link e redefine senha no app e faz login

### **Cen√°rio 2: Usu√°rio com Senha Local**
1. Usu√°rio faz login local normalmente
2. Sistema valida email e senha
3. Login bem-sucedido

### **Cen√°rio 3: Login Google**
1. Usu√°rio faz login via Google
2. Sistema valida token do Google
3. Login bem-sucedido (independente de ter senha local)

---

## üõ°Ô∏è **Considera√ß√µes de Seguran√ßa**

### **Prote√ß√µes Implementadas**
- **Tokens √∫nicos**: Cada solicita√ß√£o gera token diferente
- **Expira√ß√£o**: Tokens expiram em 15 minutos
- **Rate limiting**: Previne spam e ataques
- **Valida√ß√£o dupla**: Token + email para confirma√ß√£o
- **Hash de senha**: Senhas nunca armazenadas em texto plano

### **Valida√ß√µes de Entrada**
- **Email**: Formato v√°lido e existente no banco
- **Senha**: M√≠nimo 8 caracteres, especial + n√∫mero
- **Token**: Formato v√°lido e n√£o expirado
- **Confirma√ß√£o**: Senhas devem coincidir